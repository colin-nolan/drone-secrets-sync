---

kind: pipeline
name: lint
steps:
  - name: lint-code
    image: golangci/golangci-lint
    commands:
      - make lint-code
    depends_on: []

  - name: lint-markdown
    image: python:3-alpine
    commands:
      - apk add --update-cache make
      - pip install mdformat-gfm
      - make lint-markdown
    depends_on: []

---

kind: pipeline
name: test
steps:
  - name: test
    image: golang:alpine
    commands:
      - apk add --update-cache gcc libc-dev make
      - make test

  - name: publish-coverage
    image: robertstettner/drone-codecov
    settings:
      token: 
        from_secret: codecov_token

---

kind: pipeline
name: build
steps:
  - name: build
    image: golang:alpine
    commands:
      - apk add --update-cache make
      - make build

  - name: publish
    image: plugins/github-release:latest
    settings:
      api_key:
        from_secret: github_release_token
      files: bin/*
    when:
      event: tag
